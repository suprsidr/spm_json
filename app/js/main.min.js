"use strict";function setup(){var a=0;$("#filespath").val(settings.filesPath),settings.savePaths.forEach(function(b){$(".checks").append($('<input type="checkbox" />').attr({id:"cb_"+a,checked:"checked"}).val(b)).append($("<label />").attr({"for":"cb_"+a}).text(b)).append("<br />"),a++})}function walkFiles(){spinner.spin(document.querySelector("body"));var a={},b={},c="";settings.filesPath=$("#filespath").val(),walkr(settings.filesPath).on("file",function(d){c+="File found: "+d.name,$("#thetext").val(c);var e=d.source.split("/"),f=e[7].split(" ")[0];a[f]={title:e[7],file:d.name},settings.filesCopied[f]?settings.filesCopied[f].mtime!==Date.parse(d.stat.mtime)?(c+=" - adding to copy queue \n",$("#thetext").val(c),b[f]={source:d.source,filename:d.name,mtime:Date.parse(d.stat.mtime)}):(c+="\n",$("#thetext").val(c)):(c+=" - adding to copy queue \n",$("#thetext").val(c),b[f]={source:d.source,filename:d.name,mtime:Date.parse(d.stat.mtime)})}).start(function(d){var e=[];return $("input:checked").each(function(){e.push($(this).val())}),d?(console.log(d),!1):(spinner.spin(!1),file.save("./json/srd.json",JSON.stringify(a),function(a){a&&console.log(a)}),e.forEach(function(a){file.copy("./json/srd.json",a+"srd.json",function(b){b?(c+="error saving: "+a+"srd.json \n"+b+"\n",$("#thetext").val(c)):(c+="saved: "+a+"srd.json\n",$("#thetext").val(c))})}),e.forEach(function(a){$.each(b,function(b,d){"object"==typeof d&&file.copy(d.source,a+"SPM/"+d.filename,function(b){b?(c+="error saving: "+a+"SPM/"+d.filename+"\n"+b+"\n",$("#thetext").val(c)):(c+="copied: "+a+"SPM/"+d.filename+"\n",$("#thetext").val(c))})})}),settings.filesCopied=settings.filesCopied.concat(b),void file.save("./settings.json",JSON.stringify(settings),function(a){a?(c+="error saving settings: "+a+"\n",$("#thetext").val(c)):(c+="saved settings.json\n",$("#thetext").val(c))}))})}$(document).foundation();var gui=require("nw.gui"),file=require("file"),fs=require("fs"),walkr=require("walkr"),path=require("path"),spinOpts={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},spinner=new Spinner(spinOpts),settings={};fs.readFile("./settings.json","utf-8",function(a,b){a||""===b?(settings={filesPath:"//marketing/internal/Market Share/Spektrum SRD Files for Upload",savePaths:["//deviis/ProdInfo/Files/","//testiis/websites/ProdInfo/Files/","//cmp02-nexus01/ProdInfo/Files/"],filesCopied:{}},fs.writeFile("./settings.json",JSON.stringify(settings))):settings=JSON.parse(b),settings.filesCopied.concat=function(a){for(var b in a)this[b]=a[b];return this},setup()}),$(".x-closer").on("click",function(a){a.preventDefault(),gui.App.quit()}),$("#go").on("click",function(a){a.preventDefault(),walkFiles()});